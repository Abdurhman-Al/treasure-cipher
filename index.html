<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² - ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</title>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial; margin: 24px; line-height: 1.6; }
    .card { max-width: 980px; margin: 0 auto; padding: 18px; border: 1px solid #ddd; border-radius: 14px; }
    h1 { margin: 0 0 12px; font-size: 22px; }
    label { display:block; margin: 10px 0 6px; font-weight: 700; }
    textarea, input, select { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px; }

    /* Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ */
    #out.ltr {
      direction: ltr;
      unicode-bidi: isolate; /* â­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù… */
      text-align: right;
    }
    #out.rtl {
      direction: rtl;
      unicode-bidi: isolate;
      text-align: right;
    }

    textarea { min-height: 110px; resize: vertical; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btns { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 800; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; }
    .hint { color:#555; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color:#666; }
    .hr { height:1px; background:#eee; margin:16px 0; }

    .boxes { display:flex; gap:10px; flex-wrap: wrap; margin-top: 8px; }
    .boxword { border:1px solid #bbb; border-radius: 10px; padding:10px 12px; background:#fff; font-weight:800; }

    @media (max-width: 800px){ .row{grid-template-columns: 1fr;} }
  </style>
</head>

<body>
<div class="card">
  <h1>ğŸ” Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² â€” ØªØ´ÙÙŠØ± / ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</h1>

  <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ</label>
  <textarea id="plain"></textarea>

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙØ±Ø©</label>
  <select id="mode">
    <option value="arabic_numbers">1) ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="polybius_ar">2) Polybius Ø¹Ø±Ø¨ÙŠ</option>
    <option value="keyed_numbers">3) ØªØ´ÙÙŠØ± Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ø¹ Ù…ÙØªØ§Ø­</option>
  </select>

  <div class="btns">
    <button class="primary" id="encryptBtn">Ø´ÙÙ‘Ø±</button>
    <button class="secondary" id="decryptBtn">ÙÙƒ</button>
  </div>

  <label>Ø§Ù„Ù†Ø§ØªØ¬</label>
  <textarea id="out"></textarea>

  <div class="boxes" id="previewBoxes"></div>
</div>

<script>
/* ===== Ø«ÙˆØ§Ø¨Øª ===== */
const LRM = "\u200E"; // â­ Ø¹Ù„Ø§Ù…Ø© Ø§ØªØ¬Ø§Ù‡ Ù…Ø®ÙÙŠØ©
const ALPH = "Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";

/* ===== Ø£Ø¯ÙˆØ§Øª ===== */
const isAr = c => ALPH.includes(c);
const idxOf = c => ALPH.indexOf(c);

/* ===== ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ ===== */
function arabicToNumbers(text){
  const parts=[];
  for (const ch of text){
    if (isAr(ch)) parts.push(String(idxOf(ch)+1));
    else if (ch===" ") parts.push("|");
  }
  return LRM + parts.join("-");
}
function numbersToArabic(text){
  return text.replace(LRM,"").split("-").map(t=>{
    if(t==="|") return " ";
    const n=parseInt(t,10);
    return ALPH[n-1]||"";
  }).join("");
}

/* ===== Polybius ===== */
const COLS=5;
function polybiusEncode(text){
  return LRM + text.split(" ").map(w=>{
    let s="";
    for(const c of w){
      const i=idxOf(c);
      if(i>=0){
        s+= (Math.floor(i/COLS)+1)+""+((i%COLS)+1)+" ";
      }
    }
    return s.trim();
  }).join("|");
}
function polybiusDecode(text){
  return text.replace(LRM,"").split("|").map(w=>{
    return w.trim().split(" ").map(p=>{
      const r=parseInt(p[0])-1;
      return ALPH[r*COLS+(parseInt(p[1])-1)]||"";
    }).join("");
  }).join(" ");
}

/* ===== ØªØ´ÙÙŠØ± Ø¨Ù…ÙØªØ§Ø­ ===== */
function keyedEncode(text){
  return LRM + text.split(" ").map(w=>{
    return [...w].map(c=>{
      const i=idxOf(c);
      return i>=0 ? String(i+1).padStart(2,"0") : "";
    }).join(" ");
  }).join("|");
}
function keyedDecode(text){
  return text.replace(LRM,"").split("|").map(w=>{
    return w.trim().split(" ").map(n=>{
      return ALPH[parseInt(n,10)-1]||"";
    }).join("");
  }).join(" ");
}

/* ===== Ø§Ù„ØªØ­ÙƒÙ… ===== */
const elOut=document.getElementById("out");
const elMode=document.getElementById("mode");

function updateDir(){
  const numeric=["arabic_numbers","polybius_ar","keyed_numbers"];
  elOut.className = numeric.includes(elMode.value) ? "ltr" : "rtl";
}

function encrypt(){
  const t=document.getElementById("plain").value;
  if(elMode.value==="arabic_numbers") elOut.value=arabicToNumbers(t);
  if(elMode.value==="polybius_ar") elOut.value=polybiusEncode(t);
  if(elMode.value==="keyed_numbers") elOut.value=keyedEncode(t);
  updateDir();
}
function decrypt(){
  const t=document.getElementById("plain").value;
  if(elMode.value==="arabic_numbers") elOut.value=numbersToArabic(t);
  if(elMode.value==="polybius_ar") elOut.value=polybiusDecode(t);
  if(elMode.value==="keyed_numbers") elOut.value=keyedDecode(t);
  updateDir();
}

document.getElementById("encryptBtn").onclick=encrypt;
document.getElementById("decryptBtn").onclick=decrypt;
updateDir();
</script>
</body>
</html>
