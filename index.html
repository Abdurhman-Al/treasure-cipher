<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ูุนุจุฉ ุงูููุฒ - ุชุดููุฑ ุงููุต</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial; margin: 24px; line-height: 1.6; }
    .card { max-width: 980px; margin: 0 auto; padding: 18px; border: 1px solid #ddd; border-radius: 14px; }
    h1 { margin: 0 0 12px; font-size: 22px; }
    label { display:block; margin: 10px 0 6px; font-weight: 700; }
    textarea, input, select { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px; }
    textarea { min-height: 110px; resize: vertical; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btns { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 800; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; }
    .hint { color:#555; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color:#666; }
    .hr { height:1px; background:#eee; margin:16px 0; }

    .toggle { display:flex; align-items:center; justify-content: space-between; gap:10px; }
    .panel { border:1px dashed #ddd; border-radius: 12px; padding: 14px; background:#fafafa; display:none; margin-top: 10px; }
    .panel.open { display:block; }
    .panel h2 { margin: 0 0 10px; font-size: 16px; }
    .panel h3 { margin: 14px 0 6px; font-size: 14px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f2f2f2; padding:8px; border-radius:10px; white-space: pre-wrap; }
    table { width:100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border:1px solid #ddd; padding: 8px; text-align:center; }
    th { background:#f3f3f3; }

    .boxes { display:flex; gap:10px; flex-wrap: wrap; margin-top: 8px; }
    .boxword { border:1px solid #bbb; border-radius: 10px; padding:10px 12px; background:#fff; font-weight:800; letter-spacing: 0.5px; }
    .muted { color:#777; font-weight:600; font-size: 12px; }

    code { background:#f6f6f6; padding: 2px 6px; border-radius: 6px; }
    @media (max-width: 800px){ .row{grid-template-columns: 1fr;} }
  </style>
</head>
<body>
  <div class="card">
    <h1>๐ ูุนุจุฉ ุงูููุฒ โ ุชุดููุฑ / ูู ุชุดููุฑ ุงููุต</h1>

    <label>ุงููุต ุงูุฃุตูู</label>
    <textarea id="plain" placeholder="ูุซุงู: ุชุฌุฏ ุงูููุฒ ูู ุตุงูุฉ ุงูุจูุช"></textarea>

    <div class="row">
      <div>
        <label>ููุน ุงูุดูุฑุฉ</label>
        <select id="mode">
          <option value="arabic_numbers">1) ุชุฑููู ุงูุญุฑูู ุงูุนุฑุจูุฉ (ุง=1...)</option>
          <option value="polybius_ar">2) Polybius ุนุฑุจู (ุฑูููู ููู ุญุฑู)</option>
          <option value="keyed_numbers">3) ุชุดููุฑ ุจุงูุฃุฑูุงู ูุน ููุชุงุญ</option>
          <option value="caesar_ar">4) ููุตุฑ ุนุฑุจู (ุฅุฒุงุญุฉ)</option>
          <option value="vigenere_ar">5) Vigenรจre ุนุฑุจู (ููุชุงุญ ูููุฉ)</option>
          <option value="atbash_ar">6) Atbash ุนุฑุจู (ุนูุณ ุงูุญุฑูู)</option>
          <option value="base64">7) Base64 ูููุต</option>
        </select>
        <div class="hint" id="modeHint"></div>
      </div>

      <div>
        <label>ุงูููุชุงุญ (ุงุฎุชูุงุฑู ุญุณุจ ุงูุดูุฑุฉ)</label>
        <input id="key" placeholder="ูุซุงู: 3 ุฃู ูููุฉ ูุซู: ููุฒ" />
        <div class="small">ููุตุฑ: ุฑูู โ Vigenรจre: ูููุฉ ุนุฑุจูุฉ โ ุงูุจุงูู ูุง ูุญุชุงุฌ (ุชุดููุฑ ุงูุฃุฑูุงู ูุน ููุชุงุญ ูู ุฅุนุฏุงุฏุงุชู ุชุญุช)</div>
      </div>
    </div>

    <!-- ุฅุนุฏุงุฏุงุช ุชุดููุฑ ุงูุฃุฑูุงู ูุน ููุชุงุญ -->
    <div id="keyedControls" style="margin-top:12px; display:none;">
      <div class="hr"></div>
      <label>ุฅุนุฏุงุฏุงุช โุชุดููุฑ ุจุงูุฃุฑูุงู ูุน ููุชุงุญโ</label>

      <label>ููุท ุงูููุชุงุญ</label>
      <select id="mapStyle">
        <option value="seq">ุชุณูุณูู: ุง=1ุ ุจ=2โฆ</option>
        <option value="rev">ูุนููุณ: ุง=28ุ ุจ=27โฆ</option>
        <option value="interleave">ูุชูุงูุจ: ุง=1ุ ุจ=15ุ ุช=2ุ ุซ=16โฆ</option>
        <option value="odd_even">ููุฒุฉ ุญุฑู: ุง=1 ุซู ุช=2 ุซู ุฌ=3โฆ</option>
        <option value="seeded">ุนุดูุงุฆู ุจุจุฐุฑุฉ (Seed)</option>
      </select>

      <div class="row" style="margin-top:10px;">
        <div>
          <label>ุงูุจุฐุฑุฉ (ููููุน ุงูุนุดูุงุฆู ููุท)</label>
          <input id="seed" placeholder="ูุซุงู: 20251214 ุฃู ุฃู ุฑูู" />
          <div class="small">ุฅุฐุง ูุชุจุช ููุณ ุงูุจุฐุฑุฉุ ูุทูุน ููุณ ุงูููุชุงุญ ุฏุงุฆููุง.</div>
        </div>
        <div>
          <label>ุนุฏุฏ ุฃุฒูุงุฌ โุงูุชูููุญโ ููุทุจุงุนุฉ</label>
          <input id="hintCount" type="number" min="2" max="28" value="6" />
          <div class="small">ูุซูุงู 6 โ ูุทุจุน 6 ุฃุฒูุงุฌ ููุท ูุซู: ุง=1ุ ุจ=15โฆ</div>
        </div>
      </div>

      <div class="btns">
        <button class="secondary" id="genHintBtn">ุชูููุฏ ุชูููุญ</button>
        <button class="secondary" id="genFullKeyBtn">ุชูููุฏ ุงูููุชุงุญ ูุงูู (ููููุธูู)</button>
      </div>

      <label>ูุต ุงูุชูููุญ (ุชูุฏุฑ ุชุนุฏูู ูุฏูููุง)</label>
      <textarea id="hintText" placeholder="ูุซุงู: ุง=1ุ ุจ=15ุ ุช=2ุ ุซ=16..."></textarea>

      <label>ุงูููุชุงุญ ูุงูู (ุงุฎุชูุงุฑู โ ููููุธูู ููุท)</label>
      <textarea id="fullKeyText" placeholder="ุณูุธูุฑ ููุง ุงูููุชุงุญ ูุงูู ุฅุฐุง ุถุบุทุช ุฒุฑ ุงูุชูููุฏ"></textarea>
    </div>

    <div class="btns">
      <button class="primary" id="encryptBtn">ุดููุฑ</button>
      <button class="secondary" id="decryptBtn">ูู ุงูุชุดููุฑ</button>
      <button class="secondary" id="copyBtn">ูุณุฎ ุงููุงุชุฌ</button>
      <button class="secondary" id="swapBtn">ุจุฏูู (ุงููุงุชุฌ โ ุงููุต)</button>
      <button class="secondary" id="clearBtn">ูุณุญ</button>
      <button class="secondary" id="printBtn">๐จ๏ธ ุทุจุงุนุฉ ุจุทุงูุฉ</button>
    </div>

    <div style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center; font-weight:700;">
        <input type="checkbox" id="printFullKey" />
        ุงุทุจุน ุงูููุชุงุญ ูุงูู (ููุญุงูุงุช ุงูุตุนุจุฉ)
      </label>

      <label style="display:flex; gap:10px; align-items:center; font-weight:700;">
        <input type="checkbox" id="printBoxes" checked />
        ุงุทุจุน ุงููููุงุช ุฏุงุฎู ุตูุงุฏูู (ุจุฏู ุณุทุฑ ูุงุญุฏ)
      </label>
      <div class="small">ุงููููุงุช ุชููุตู ุจู <code>|</code>ุ ููุฐุง ุงูุฎูุงุฑ ููุท ูุทุฑููุฉ ุนุฑุถูุง ูู ุงูุทุจุงุนุฉ.</div>
    </div>

    <label>ุงููุงุชุฌ</label>
    <textarea id="out" placeholder="ุณูุธูุฑ ููุง ุงููุต ุงููุดููุฑ ุฃู ุงูููููู"></textarea>

    <div class="muted" id="previewLabel" style="margin-top:10px; display:none;">ูุนุงููุฉ (ูููุงุช ุฏุงุฎู ุตูุงุฏูู):</div>
    <div class="boxes" id="previewBoxes" style="display:none;"></div>

    <div class="hr"></div>

    <div class="toggle">
      <div style="font-weight:800;">๐ ุดุฑุญ ุงูุชุดููุฑ (ููุงุณุชุฎุฏุงู/ุงูุชุฌุฑุจุฉ)</div>
      <button class="secondary" id="toggleHelpBtn">ุฅุธูุงุฑ ุงูุดุฑุญ</button>
    </div>
    <div class="panel" id="helpPanel">
      <h2 id="helpTitle">ุดุฑุญ</h2>
      <div id="helpText"></div>
      <div id="exampleBlock" style="margin-top:10px;">
        <h3>ูุซุงู ุณุฑูุน</h3>
        <div class="mono" id="helpExample"></div>
      </div>
      <div id="tableBlock" style="margin-top:10px;">
        <h3 id="tableTitle">ุฌุฏูู</h3>
        <div id="helpTable"></div>
      </div>
      <p class="small" style="margin-top:10px;">โ ุฃุซูุงุก ุงููุนุจุฉ ุงุณุชุฎุฏู โุงูุชูููุญโ ุงููู ุชูุชุจู ุฃูุช.</p>
    </div>
  </div>

<script>
/** ===== Alphabet handling (Arabic) ===== */
const ALPH = "ุงุจุชุซุฌุญุฎุฏุฐุฑุฒุณุดุตุถุทุธุนุบููููููููู";
const normMap = new Map([
  ["ุฃ","ุง"],["ุฅ","ุง"],["ุข","ุง"],["ูฑ","ุง"],
  ["ุฉ","ู"],["ู","ู"],
]);
function normalizeArabicChar(ch){ return normMap.get(ch) ?? ch; }
function isArabicLetter(ch){ return ALPH.includes(normalizeArabicChar(ch)); }
function alphaIndex(ch){ return ALPH.indexOf(normalizeArabicChar(ch)); }
function shiftArabicChar(ch, shift){
  const c = normalizeArabicChar(ch);
  const i = ALPH.indexOf(c);
  if (i === -1) return ch;
  const n = ALPH.length;
  const j = (i + ((shift % n) + n)) % n;
  return ALPH[j];
}

/** ===== 1) Arabic letters to numbers ===== */
function arabicToNumbers(text){
  const parts = [];
  for (const ch of text){
    if (isArabicLetter(ch)) parts.push(String(alphaIndex(ch) + 1));
    else parts.push(ch === " " ? "|" : ch);
  }
  return parts.join("-");
}
function numbersToArabic(text){
  const tokens = text.split("-");
  let out = "";
  for (const t of tokens){
    if (t === "|") { out += " "; continue; }
    if (/^\d+$/.test(t)){
      const num = parseInt(t,10);
      out += (num >= 1 && num <= ALPH.length) ? ALPH[num-1] : t;
    } else out += t;
  }
  return out;
}

/** ===== 2) Polybius Arabic (6x5) ===== */
const POLY_ROWS = 6, POLY_COLS = 5;
function polybiusEncode(text){
  const outWords = [];
  for (const w of text.split(" ")){
    let digits = "";
    for (const ch0 of w){
      const ch = normalizeArabicChar(ch0);
      const idx = ALPH.indexOf(ch);
      if (idx === -1) digits += "_" + ch0 + "_";
      else {
        const r = Math.floor(idx / POLY_COLS) + 1;
        const c = (idx % POLY_COLS) + 1;
        digits += String(r) + String(c);
      }
    }
    outWords.push(digits);
  }
  return outWords.join("|");
}
function polybiusDecode(text){
  const out = [];
  for (const w of text.split("|")){
    let s = "", i = 0;
    while (i < w.length){
      if (w[i] === "_"){
        const j = w.indexOf("_", i+1);
        if (j !== -1){ s += w.slice(i+1, j); i = j + 1; continue; }
      }
      const a = w[i], b = w[i+1];
      if (!a || !b) break;
      if (/\d/.test(a) && /\d/.test(b)){
        const r = parseInt(a,10), c = parseInt(b,10);
        const idx = (r-1)*POLY_COLS + (c-1);
        s += (idx >= 0 && idx < ALPH.length) ? ALPH[idx] : "๏ฟฝ";
        i += 2;
      } else { s += w[i]; i += 1; }
    }
    out.push(s);
  }
  return out.join(" ");
}
function buildPolybiusTable(){
  let html = "<table><thead><tr><th>ุตู\\ุนููุฏ</th>";
  for (let c=1;c<=POLY_COLS;c++) html += `<th>${c}</th>`;
  html += "</tr></thead><tbody>";
  let k=0;
  for (let r=1;r<=POLY_ROWS;r++){
    html += `<tr><th>${r}</th>`;
    for (let c=1;c<=POLY_COLS;c++){
      const ch =
