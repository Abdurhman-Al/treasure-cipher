<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² â€” ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</title>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial; margin: 24px; line-height: 1.6; background:#fff; }
    .card { max-width: 980px; margin: 0 auto; padding: 18px; border: 1px solid #ddd; border-radius: 14px; }
    h1 { margin: 0 0 12px; font-size: 22px; }
    label { display:block; margin: 10px 0 6px; font-weight: 800; }
    textarea, input, select { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px; background:#fff; }
    textarea { min-height: 110px; resize: vertical; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 800px){ .row{grid-template-columns: 1fr;} }

    .btns { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; align-items:center; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 800; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; }
    .hint { color:#555; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color:#666; }
    .hr { height:1px; background:#eee; margin:16px 0; }

    /* Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ */
    #out.ltr{
      direction:ltr;
      unicode-bidi:bidi-override;
      text-align:right;
    }
    #out.rtl{
      direction:rtl;
      unicode-bidi:plaintext;
      text-align:right;
    }

    .muted { color:#777; font-weight:700; font-size: 12px; }
    .panel { border:1px dashed #ddd; border-radius: 12px; padding: 14px; background:#fafafa; display:none; margin-top: 10px; }
    .panel.open { display:block; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f2f2f2; padding:8px; border-radius:10px; white-space: pre-wrap; }

    .boxes { display:flex; gap:10px; flex-wrap: wrap; margin-top: 8px; direction: rtl; align-items:flex-start; }
    .boxword {
      border:1px solid #bbb;
      border-radius: 10px;
      padding:10px 12px;
      background:#fff;
      font-weight:800;
      direction:ltr;
      unicode-bidi:bidi-override;
      text-align:right;
    }
    code { background:#f6f6f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>

<body>
  <div class="card">
    <h1>ğŸ” Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² â€” ØªØ´ÙÙŠØ± / ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</h1>

    <label>Ø§Ù„Ù†Øµ</label>
    <textarea id="plain" placeholder="Ù…Ø«Ø§Ù„: ØªØ¬Ø¯ Ø§Ù„ÙƒÙ†Ø² ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¨ÙŠØª"></textarea>

    <div class="row">
      <div>
        <label>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙØ±Ø©</label>
        <select id="mode">
          <option value="num_ar">1) (Ø£Ø±Ù‚Ø§Ù…) ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="caesar_ar">2) (Ø­Ø±ÙˆÙ) Ø§Ù„Ø¥Ø²Ø§Ø­Ø© (Ù‚ÙŠØµØ±)</option>
          <option value="reverse_words">3) (Ø­Ø±ÙˆÙ) Ø¹ÙƒØ³ ÙƒÙ„ ÙƒÙ„Ù…Ø©</option>
        </select>
        <div class="hint" id="modeHint"></div>
      </div>

      <div id="keyWrap">
        <label>Ø§Ù„Ù…ÙØªØ§Ø­ (ÙÙ‚Ø· Ù„Ù‚ÙŠØµØ±)</label>
        <input id="key" placeholder="Ù…Ø«Ø§Ù„: 3" />
        <div class="small">Ù„Ù€ â€œØ¹ÙƒØ³ ÙƒÙ„ ÙƒÙ„Ù…Ø©â€ Ùˆ â€œØ§Ù„Ø£Ø±Ù‚Ø§Ù…â€ Ù„Ø§ ØªØ­ØªØ§Ø¬ Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§.</div>
      </div>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
    <div id="numControls" style="margin-top:12px;">
      <div class="hr"></div>
      <label>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)</label>

      <label>Ù†Ù…Ø· Ø§Ù„ØªØ±Ù‚ÙŠÙ…</label>
      <select id="numStyle">
        <option value="seq">Ù…ØªØ³Ù„Ø³Ù„: Ø§=01ØŒ Ø¨=02â€¦</option>
        <option value="interleave">Ù…ØªÙ†Ø§ÙˆØ¨: Ø§=01ØŒ Ø¨=15ØŒ Øª=02â€¦</option>
        <option value="rev">Ù…Ø¹ÙƒÙˆØ³: Ø§=28ØŒ Ø¨=27â€¦</option>
        <option value="odd">ÙØ±Ø¯ÙŠ: Ø§=01ØŒ Ø¨=03ØŒ Øª=05â€¦</option>
        <option value="even">Ø²ÙˆØ¬ÙŠ: Ø§=02ØŒ Ø¨=04ØŒ Øª=06â€¦</option>
      </select>

      <div class="row" style="margin-top:10px;">
        <div>
          <label>Ø¹Ø¯Ø¯ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„ØªÙ„Ù…ÙŠØ­</label>
          <input id="hintCount" type="number" min="2" max="28" value="6" />
          <div class="small">Ù…Ø«Ù„Ø§Ù‹ 6 â†’ ÙŠØ·Ø¨Ø¹ 6 Ø£Ø²ÙˆØ§Ø¬ ÙÙ‚Ø· (Ù„Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†).</div>
        </div>
        <div>
          <label>ØªÙˆÙ„ÙŠØ¯</label>
          <div class="btns" style="margin-top:0;">
            <button class="secondary" id="genHintBtn">ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù…ÙŠØ­</button>
            <button class="secondary" id="genFullKeyBtn">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ ÙƒØ§Ù…Ù„ (Ù„Ù„Ù…Ù†Ø¸Ù‘Ù…)</button>
          </div>
        </div>
      </div>

      <label>Ø§Ù„ØªÙ„Ù…ÙŠØ­ (Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙŠ ØªØ¹Ø·ÙŠÙ‡ Ù„Ù„Ù…ØªØ³Ø§Ø¨Ù‚)</label>
      <textarea id="hintText" placeholder="Ù…Ø«Ø§Ù„: Ø§=01ØŒ Ø¨=15ØŒ Øª=02..."></textarea>

      <label>Ø§Ù„Ù…ÙØªØ§Ø­ ÙƒØ§Ù…Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ù…Ù†Ø¸Ù‘Ù… ÙÙ‚Ø·)</label>
      <textarea id="fullKeyText" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ ÙƒØ§Ù…Ù„"></textarea>

      <div class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªÙØµÙ„ Ø¨Ù…Ø³Ø§ÙØ©ØŒ ÙˆØ¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª <code>|</code>. âœ… ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¯Ø§Ø®Ù„ ÙƒÙ„ ÙƒÙ„Ù…Ø© ØªÙØ¹ÙƒØ³ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.</div>
    </div>

    <div class="btns">
      <button class="primary" id="encryptBtn">Ø´ÙÙ‘Ø±</button>
      <button class="secondary" id="decryptBtn">ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</button>
      <button class="secondary" id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ù†Ø§ØªØ¬</button>
      <button class="secondary" id="swapBtn">Ø¨Ø¯Ù‘Ù„ (Ø§Ù„Ù†Ø§ØªØ¬ â† Ø§Ù„Ù†Øµ)</button>
      <button class="secondary" id="clearBtn">Ù…Ø³Ø­</button>
      <button class="secondary" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø·Ø§Ù‚Ø©</button>
    </div>

    <label>Ø§Ù„Ù†Ø§ØªØ¬</label>
    <textarea id="out" class="ltr" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙÙ‘Ø± Ø£Ùˆ Ø§Ù„Ù…ÙÙƒÙˆÙƒ"></textarea>

    <div class="muted" id="previewLabel" style="margin-top:10px; display:none;">Ù…Ø¹Ø§ÙŠÙ†Ø© (ÙƒÙ„Ù…Ø§Øª Ø¯Ø§Ø®Ù„ ØµÙ†Ø§Ø¯ÙŠÙ‚):</div>
    <div class="boxes" id="previewBoxes" style="display:none;"></div>

    <div class="hr"></div>

    <div style="display:flex; align-items:center; justify-content: space-between; gap:10px;">
      <div style="font-weight:800;">ğŸ“˜ Ø´Ø±Ø­ Ø§Ù„ØªØ´ÙÙŠØ±</div>
      <button class="secondary" id="toggleHelpBtn">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±Ø­</button>
    </div>

    <div class="panel" id="helpPanel">
      <div class="mono" id="helpText">Ø§Ø®ØªÙØ± Ù†ÙˆØ¹ Ø§Ù„Ø´ÙØ±Ø© Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§.</div>
    </div>
  </div>

<script>
/** ===== Arabic alphabet & helpers ===== */
const ALPH = "Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";
const normMap = new Map([["Ø£","Ø§"],["Ø¥","Ø§"],["Ø¢","Ø§"],["Ù±","Ø§"],["Ø©","Ù‡"],["Ù‰","ÙŠ"]]);
const norm = ch => normMap.get(ch) ?? ch;

function pad2(n){ return String(n).padStart(2,"0"); }

function shiftAr(ch, s){
  const c = norm(ch);
  const i = ALPH.indexOf(c);
  if (i === -1) return ch;
  const n = ALPH.length;
  return ALPH[(i + ((s % n)+n)) % n];
}

/** ===== (Ø­Ø±ÙˆÙ) Caesar ===== */
function caesarEncrypt(text, k){
  const s = parseInt(k,10);
  if (Number.isNaN(s)) return "âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ù‹Ø§ Ù„Ù„Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„ 3)";
  let out="";
  for (const ch of text) out += shiftAr(ch, s);
  return out;
}
function caesarDecrypt(text, k){
  const s = parseInt(k,10);
  if (Number.isNaN(s)) return "âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ù‹Ø§ Ù„Ù„Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„ 3)";
  let out="";
  for (const ch of text) out += shiftAr(ch, -s);
  return out;
}

/** ===== (Ø­Ø±ÙˆÙ) Reverse each word ===== */
function reverseEachWord(text){
  return (text ?? "")
    .trim()
    .split(/\s+/)
    .map(w => [...w].reverse().join(""))
    .join(" ");
}

/** ===== (Ø£Ø±Ù‚Ø§Ù…) Mapping ===== */
function makeOrder(style){
  const base = ALPH.split("");

  if(style === "rev"){
    return [...base].reverse();
  }

  if(style === "interleave"){
    const half = Math.ceil(base.length/2); // 14
    const A = base.slice(0, half);
    const B = base.slice(half);
    const out=[];
    for(let i=0;i<half;i++){
      if(A[i]) out.push(A[i]);
      if(B[i]) out.push(B[i]);
    }
    return out;
  }

  return base; // seq / odd / even
}

function makeMapping(style){
  const order = makeOrder(style);
  const map = new Map(); // char -> num
  const inv = new Map(); // num -> char

  for(let i=0;i<order.length;i++){
    let num;
    if(style === "odd") num = 1 + 2*i;       // 1..55
    else if(style === "even") num = 2 + 2*i; // 2..56
    else num = i + 1; // 1..28

    map.set(order[i], num);
    inv.set(num, order[i]);
  }
  return {order, map, inv};
}

/** ===== (Ø£Ø±Ù‚Ø§Ù…) Encode/Decode
    Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø¹ÙƒØ³ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¯Ø§Ø®Ù„ ÙƒÙ„ ÙƒÙ„Ù…Ø© Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© (08 05 03)
*/
function encodeNumbers(text, style){
  const {map} = makeMapping(style);
  const words = (text ?? "").trim().split(/\s+/).filter(Boolean);

  const encWords = words.map(w=>{
    const toks=[];
    for(const ch0 of w){
      const ch = norm(ch0);
      if(ALPH.includes(ch)){
        toks.push(pad2(map.get(ch)));
      }else{
        toks.push(`_${ch0}_`);
      }
    }
    // âœ… Ø¹ÙƒØ³ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© (Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨)
    toks.reverse();
    return toks.join(" ");
  });

  return encWords.join(" | ");
}

function decodeNumbers(text, style){
  const {inv} = makeMapping(style);
  const t = (text ?? "").trim();
  const parts = t.split("|").map(s=>s.trim()).filter(Boolean);

  const outWords = parts.map(part=>{
    const toks = part.split(/\s+/).filter(Boolean);
    // âœ… Ù„Ø£Ù† Ø§Ù„ØªØ´ÙÙŠØ± ÙŠØ¹ÙƒØ³ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©ØŒ Ù†ÙÙƒÙ‡Ø§ Ø¨Ø¹ÙƒØ³ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø­Ø±ÙˆÙ
    toks.reverse();

    let out="";
    for(const tok of toks){
      if(tok.startsWith("_") && tok.endsWith("_") && tok.length>=3){
        out += tok.slice(1,-1);
        continue;
      }
      if(/^\d+$/.test(tok)){
        const n = parseInt(tok,10);
        out += inv.get(n) || "ï¿½";
      }else{
        out += tok;
      }
    }
    return out;
  });

  return outWords.join(" ");
}

function buildHint(style, count){
  const {order, map} = makeMapping(style);
  const n = Math.max(2, Math.min(28, parseInt(count,10) || 6));
  return order.slice(0,n).map(ch => `${ch}=${pad2(map.get(ch))}`).join("ØŒ ");
}
function buildFullKey(style){
  const {order, map} = makeMapping(style);
  return order.map(ch => `${ch}=${pad2(map.get(ch))}`).join("ØŒ ");
}

/** ===== UI ===== */
const elPlain = document.getElementById("plain");
const elOut   = document.getElementById("out");
const elMode  = document.getElementById("mode");
const elKey   = document.getElementById("key");
const elModeHint = document.getElementById("modeHint");

const numControls = document.getElementById("numControls");
const elNumStyle = document.getElementById("numStyle");
const elHintCount = document.getElementById("hintCount");
const elHintText = document.getElementById("hintText");
const elFullKeyText = document.getElementById("fullKeyText");

const previewLabel = document.getElementById("previewLabel");
const previewBoxes = document.getElementById("previewBoxes");

const helpPanel = document.getElementById("helpPanel");
const helpText = document.getElementById("helpText");
const toggleHelpBtn = document.getElementById("toggleHelpBtn");

function updateModeUI(){
  const m = elMode.value;

  numControls.style.display = (m === "num_ar") ? "block" : "none";
  document.getElementById("keyWrap").style.display = (m === "caesar_ar") ? "block" : "none";

  const numeric = (m === "num_ar");
  elOut.classList.remove("ltr","rtl");
  elOut.classList.add(numeric ? "ltr" : "rtl");

  const hints = {
    num_ar: "Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©: Ø£Ø±Ù‚Ø§Ù… Ù…ÙØµÙˆÙ„Ø© Ø¨Ù…Ø³Ø§ÙØ©ØŒ ÙˆØ¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª | âœ… (Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¯Ø§Ø®Ù„ ÙƒÙ„ ÙƒÙ„Ù…Ø© Ù…Ø¹ÙƒÙˆØ³Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)",
    caesar_ar: "Ù‚ÙŠØµØ±: Ø¥Ø²Ø§Ø­Ø© Ø§Ù„Ø­Ø±ÙˆÙ Ø¨Ø¹Ø¯Ø¯ Ø«Ø§Ø¨Øª (Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙØªØ§Ø­).",
    reverse_words: "ÙŠØ¹ÙƒØ³ ÙƒÙ„ ÙƒÙ„Ù…Ø©: ØªØ¬Ø¯ Ø§Ù„ÙƒÙ†Ø² â†’ Ø¯Ø¬Øª Ø²Ù†ÙƒÙ„Ø§"
  };
  elModeHint.textContent = hints[m] || "";

  updateHelp();
  renderBoxesPreview();
}

function updateHelp(){
  const m = elMode.value;
  if(m === "num_ar"){
    helpText.textContent =
`(Ø£Ø±Ù‚Ø§Ù…) ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©: 08 05 03  (âœ… Ù…Ø¹ÙƒÙˆØ³ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©)
- Ø¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª: |
- Ø§Ù„ØªÙ„Ù…ÙŠØ­: Ø§ÙƒØªØ¨ Ø¹Ø¯Ø© Ø£Ø²ÙˆØ§Ø¬ Ù…Ø«Ù„: Ø§=01ØŒ Ø¨=02...

Ø§Ù„Ø£Ù†Ù…Ø§Ø·:
- Ù…ØªØ³Ù„Ø³Ù„ / Ù…ØªÙ†Ø§ÙˆØ¨ / Ù…Ø¹ÙƒÙˆØ³ / ÙØ±Ø¯ÙŠ / Ø²ÙˆØ¬ÙŠ
`;
  } else if(m === "caesar_ar"){
    helpText.textContent =
`(Ø­Ø±ÙˆÙ) Ø§Ù„Ø¥Ø²Ø§Ø­Ø© (Ù‚ÙŠØµØ±)
- Ø§Ù„Ù…ÙØªØ§Ø­ Ø±Ù‚Ù… (Ù…Ø«Ù„Ø§Ù‹ 3)
- Ø´ÙÙ‘Ø±: ÙŠØ­Ø±Ùƒ Ø§Ù„Ø­Ø±ÙˆÙ Ù„Ù„Ø£Ù…Ø§Ù…
- ÙÙƒ: ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø­Ø±ÙˆÙ Ù„Ù„Ø®Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…
`;
  } else {
    helpText.textContent =
`(Ø­Ø±ÙˆÙ) Ø¹ÙƒØ³ ÙƒÙ„ ÙƒÙ„Ù…Ø©
- Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ù…ÙØªØ§Ø­
- ÙŠØ¹ÙƒØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø±ÙˆÙ Ø¯Ø§Ø®Ù„ ÙƒÙ„ ÙƒÙ„Ù…Ø© ÙÙ‚Ø·
Ù…Ø«Ø§Ù„: ØªØ¬Ø¯ Ø§Ù„ÙƒÙ†Ø² â†’ Ø¯Ø¬Øª Ø²Ù†ÙƒÙ„Ø§
`;
  }
}

function escapeHtml(s){
  return (s ?? "").toString().replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}

function renderBoxesPreview(){
  const m = elMode.value;
  const v = (elOut.value||"").trim();

  if(m !== "num_ar" || !v.includes("|")){
    previewLabel.style.display="none";
    previewBoxes.style.display="none";
    previewBoxes.innerHTML="";
    return;
  }

  const words = v.split("|").map(s=>s.trim()).filter(Boolean);
  previewBoxes.innerHTML = words.map(w => `<div class="boxword">${escapeHtml(w)}</div>`).join("");
  previewLabel.style.display="block";
  previewBoxes.style.display="flex";
}

/** ===== Actions ===== */
function encrypt(){
  const text = elPlain.value;
  const m = elMode.value;

  if(m === "num_ar"){
    elOut.value = encodeNumbers(text, elNumStyle.value);
  } else if(m === "caesar_ar"){
    elOut.value = caesarEncrypt(text, elKey.value);
  } else if(m === "reverse_words"){
    elOut.value = reverseEachWord(text);
  }
  renderBoxesPreview();
}

function decrypt(){
  const text = elPlain.value;
  const m = elMode.value;

  try{
    if(m === "num_ar"){
      elOut.value = decodeNumbers(text, elNumStyle.value);
    } else if(m === "caesar_ar"){
      elOut.value = caesarDecrypt(text, elKey.value);
    } else if(m === "reverse_words"){
      elOut.value = reverseEachWord(text);
    }
  }catch(e){
    elOut.value = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª";
  }
  renderBoxesPreview();
}

async function copyOut(){
  try{ await navigator.clipboard.writeText(elOut.value); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…"); }
  catch{ elOut.select(); document.execCommand("copy"); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…"); }
}
function swapOut(){
  elPlain.value = elOut.value;
  elOut.value = "";
  renderBoxesPreview();
}
function clearAll(){
  elPlain.value="";
  elOut.value="";
  elKey.value="";
  elHintText.value="";
  elFullKeyText.value="";
  renderBoxesPreview();
}

/** ===== Hint Buttons ===== */
function genHint(){
  if(elMode.value !== "num_ar") return;
  elHintText.value = buildHint(elNumStyle.value, elHintCount.value);
}
function genFull(){
  if(elMode.value !== "num_ar") return;
  elFullKeyText.value = buildFullKey(elNumStyle.value);
}

/** ===== Print Card ===== */
function printCard(){
  const cipher = (elOut.value||"").trim();
  if(!cipher){ alert("Ø´ÙÙ‘Ø± Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø·Ø¨Ø¹."); return; }

  const m = elMode.value;
  const hint = (m==="num_ar" ? (elHintText.value||"").trim() : "");

  let bodyHTML = "";

  if(m === "num_ar"){
    const parts = cipher.includes("|")
      ? cipher.split("|").map(s=>s.trim()).filter(Boolean)
      : [cipher];

    const boxes = parts.map(w => `
      <div style="direction:ltr;unicode-bidi:bidi-override;text-align:right;border:1px solid #bbb;border-radius:12px;padding:10px 12px;font-size:18px;font-weight:900;margin:4px;">
        ${escapeHtml(w)}
      </div>
    `).join("");

    bodyHTML = `
      <div style="display:flex;gap:10px;flex-wrap:wrap;direction:rtl;align-items:flex-start;">${boxes}</div>
      <div style="margin-top:12px;font-size:14px;"><b>Ø§Ù„Ù…ÙØªØ§Ø­ / Ø§Ù„ØªÙ„Ù…ÙŠØ­:</b> ${hint ? escapeHtml(hint) : "(Ø¶Ø¹ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ù‡Ù†Ø§)"}</div>
    `;
  } else {
    bodyHTML = `
      <div style="border:1px dashed #999;border-radius:12px;padding:12px;font-size:18px;word-break:break-word;direction:rtl;unicode-bidi:plaintext;text-align:right;">
        ${escapeHtml(cipher)}
      </div>
    `;
    if(m==="caesar_ar"){
      bodyHTML += `<div style="margin-top:12px;font-size:14px;"><b>Ø§Ù„Ù…ÙØªØ§Ø­:</b> ${escapeHtml(elKey.value||"")}</div>`;
    }
    if(m==="reverse_words"){
      bodyHTML += `<div style="margin-top:12px;font-size:14px;"><b>Ø§Ù„ØªÙ„Ù…ÙŠØ­:</b> Ø¹ÙƒØ³ ÙƒÙ„ ÙƒÙ„Ù…Ø©</div>`;
    }
  }

  const html = `<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø¨Ø·Ø§Ù‚Ø© Ù„ØºØ²</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Tahoma,Arial;margin:24px;line-height:1.7;}
    .box{border:2px solid #111;border-radius:14px;padding:16px;max-width:900px;}
    @media print{body{margin:0}.box{border:0;border-radius:0}}
  </style></head><body>
  <div class="box">
    <h2 style="margin:0 0 10px;">ğŸ—ï¸ Ø¨Ø·Ø§Ù‚Ø© Ù„ØºØ² â€” Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø²</h2>
    ${bodyHTML}
  </div>
  </body></html>`;

  const w=window.open("","_blank");
  w.document.open();
  w.document.write(html);
  w.document.close();
  w.focus();
  setTimeout(()=>w.print(), 200);
}

/** ===== Bindings ===== */
document.getElementById("encryptBtn").addEventListener("click", encrypt);
document.getElementById("decryptBtn").addEventListener("click", decrypt);
document.getElementById("copyBtn").addEventListener("click", copyOut);
document.getElementById("swapBtn").addEventListener("click", swapOut);
document.getElementById("clearBtn").addEventListener("click", clearAll);
document.getElementById("printBtn").addEventListener("click", printCard);

document.getElementById("genHintBtn").addEventListener("click", genHint);
document.getElementById("genFullKeyBtn").addEventListener("click", genFull);

toggleHelpBtn.addEventListener("click", ()=>{
  helpPanel.classList.toggle("open");
  toggleHelpBtn.textContent = helpPanel.classList.contains("open") ? "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±Ø­" : "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±Ø­";
});

elMode.addEventListener("change", updateModeUI);
elNumStyle.addEventListener("change", ()=>{ if(elMode.value==="num_ar") updateHelp(); });

/** start */
updateModeUI();
</script>
</body>
</html>
