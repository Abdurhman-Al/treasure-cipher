<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² - ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial; margin: 24px; line-height: 1.6; }
    .card { max-width: 980px; margin: 0 auto; padding: 18px; border: 1px solid #ddd; border-radius: 14px; }
    h1 { margin: 0 0 12px; font-size: 22px; }
    label { display:block; margin: 10px 0 6px; font-weight: 600; }
    textarea, input, select { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px; }
    textarea { min-height: 110px; resize: vertical; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btns { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 800; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; }
    .hint { color:#555; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color:#666; }
    .hr { height:1px; background:#eee; margin:16px 0; }

    /* Ø´Ø±Ø­ Ø§Ù„ØªØ´ÙÙŠØ± */
    .toggle { display:flex; align-items:center; justify-content: space-between; gap:10px; }
    .toggle button { font-weight: 800; }
    .panel { border:1px dashed #ddd; border-radius: 12px; padding: 14px; background:#fafafa; display:none; margin-top: 10px; }
    .panel.open { display:block; }
    .panel h2 { margin: 0 0 10px; font-size: 16px; }
    .panel h3 { margin: 14px 0 6px; font-size: 14px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f2f2f2; padding:8px; border-radius:10px; white-space: pre-wrap; }
    table { width:100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border:1px solid #ddd; padding: 8px; text-align:center; }
    th { background:#f3f3f3; }

    @media (max-width: 800px){ .row{grid-template-columns: 1fr;} }
    code { background:#f6f6f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ” Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² â€” ØªØ´ÙÙŠØ± / ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ</h1>

    <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ</label>
    <textarea id="plain" placeholder="Ù…Ø«Ø§Ù„: ØªØ¬Ø¯ Ø§Ù„ÙƒÙ†Ø² ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¨ÙŠØª"></textarea>

    <div class="row">
      <div>
        <label>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙØ±Ø©</label>
        <select id="mode">
          <option value="arabic_numbers">1) ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§=1...)</option>
          <option value="caesar_ar">2) Ù‚ÙŠØµØ± Ø¹Ø±Ø¨ÙŠ (Ø¥Ø²Ø§Ø­Ø©)</option>
          <option value="vigenere_ar">3) VigenÃ¨re Ø¹Ø±Ø¨ÙŠ (Ù…ÙØªØ§Ø­ ÙƒÙ„Ù…Ø©)</option>
          <option value="atbash_ar">4) Atbash Ø¹Ø±Ø¨ÙŠ (Ø¹ÙƒØ³ Ø§Ù„Ø­Ø±ÙˆÙ)</option>
          <option value="base64">5) Base64 Ù„Ù„Ù†Øµ</option>
        </select>
        <div class="hint" id="modeHint"></div>
      </div>

      <div>
        <label>Ø§Ù„Ù…ÙØªØ§Ø­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø´ÙØ±Ø©)</label>
        <input id="key" placeholder="Ù…Ø«Ø§Ù„: 3 Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ø«Ù„: ÙƒÙ†Ø²" />
        <div class="small">Ù‚ÙŠØµØ±: Ø±Ù‚Ù… (Ù…Ø«Ù„ 3) â€” VigenÃ¨re: ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ© (Ù…Ø«Ù„ ÙƒÙ†Ø²) â€” Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„Ø§ ÙŠØ­ØªØ§Ø¬</div>
      </div>
    </div>

    <div class="btns">
      <button class="primary" id="encryptBtn">Ø´ÙÙ‘Ø±</button>
      <button class="secondary" id="decryptBtn">ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</button>
      <button class="secondary" id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ù†Ø§ØªØ¬</button>
      <button class="secondary" id="swapBtn">Ø¨Ø¯Ù‘Ù„ (Ø§Ù„Ù†Ø§ØªØ¬ â† Ø§Ù„Ù†Øµ)</button>
      <button class="secondary" id="clearBtn">Ù…Ø³Ø­</button>
    </div>

    <label>Ø§Ù„Ù†Ø§ØªØ¬</label>
    <textarea id="out" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙÙ‘Ø± Ø£Ùˆ Ø§Ù„Ù…ÙÙƒÙˆÙƒ"></textarea>

    <div class="hr"></div>

    <!-- Ø²Ø± Ø´Ø±Ø­ Ø§Ù„ØªØ´ÙÙŠØ± -->
    <div class="toggle">
      <div style="font-weight:800;">ğŸ“˜ Ø´Ø±Ø­ Ø§Ù„ØªØ´ÙÙŠØ± (ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±)</div>
      <button class="secondary" id="toggleHelpBtn">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±Ø­</button>
    </div>
    <div class="panel" id="helpPanel">
      <h2 id="helpTitle">Ø´Ø±Ø­</h2>
      <div id="helpText"></div>

      <div id="exampleBlock" style="margin-top:10px;">
        <h3>Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</h3>
        <div class="mono" id="helpExample"></div>
      </div>

      <div id="tableBlock" style="margin-top:10px;">
        <h3 id="tableTitle">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø±ÙˆÙ</h3>
        <div id="helpTable"></div>
      </div>

      <p class="small" style="margin-top:10px;">
        âœ… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø£Ù„ØºØ§Ø² ÙˆÙ„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø². Ù„ÙŠØ³ Ù„Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ.
      </p>
    </div>

  </div>

<script>
/** ===== Alphabet handling (Arabic) =====
 * Ø£Ø¨Ø¬Ø¯ÙŠØ© Ø¹Ø±Ø¨ÙŠØ© â€œÙ…Ø¨Ø³Ø·Ø©â€ Ù„Ù„Ø¥Ø²Ø§Ø­Ø©/Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„.
 * Ù†Ø·Ø¨Ø¹ Ø§Ù„Ø´Ø±Ø­ Ø¨Ø§Ù„Ø­Ø±ÙˆÙ Ø¨Ø¯ÙˆÙ† ØªÙÙ„Ø³Ù Ø¹Ø´Ø§Ù† ØªÙƒÙˆÙ† Ù„Ø¹Ø¨Ø© ÙƒÙ†Ø² Ø³Ù‡Ù„Ø©.
 */
const ALPH = "Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ";
const normMap = new Map([
  ["Ø£","Ø§"],["Ø¥","Ø§"],["Ø¢","Ø§"],["Ù±","Ø§"],
  ["Ø©","Ù‡"],["Ù‰","ÙŠ"],
]);

function normalizeArabicChar(ch){
  return normMap.get(ch) ?? ch;
}

function isArabicLetter(ch){
  const c = normalizeArabicChar(ch);
  return ALPH.includes(c);
}

function alphaIndex(ch){
  const c = normalizeArabicChar(ch);
  return ALPH.indexOf(c);
}

function shiftArabicChar(ch, shift){
  const c = normalizeArabicChar(ch);
  const i = ALPH.indexOf(c);
  if (i === -1) return ch;
  const n = ALPH.length;
  const j = (i + ((shift % n) + n) ) % n;
  return ALPH[j];
}

/** ===== 1) Arabic letters to numbers ===== */
function arabicToNumbers(text){
  const parts = [];
  for (const ch of text){
    if (isArabicLetter(ch)){
      parts.push(String(alphaIndex(ch) + 1));
    } else {
      if (ch === " ") parts.push("|"); // ÙØ§ØµÙ„ ÙƒÙ„Ù…Ø§Øª
      else parts.push(ch);
    }
  }
  return parts.join("-");
}

function numbersToArabic(text){
  const tokens = text.split("-");
  let out = "";
  for (const t of tokens){
    if (t === "|") { out += " "; continue; }
    if (/^\d+$/.test(t)){
      const num = parseInt(t,10);
      if (num >= 1 && num <= ALPH.length) out += ALPH[num-1];
      else out += t;
    } else {
      out += t;
    }
  }
  return out;
}

/** ===== 2) Caesar Arabic ===== */
function caesarEncrypt(text, key){
  const s = parseInt(key,10);
  if (Number.isNaN(s)) return "âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„ 3)";
  let out = "";
  for (const ch of text) out += shiftArabicChar(ch, s);
  return out;
}
function caesarDecrypt(text, key){
  const s = parseInt(key,10);
  if (Number.isNaN(s)) return "âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„ 3)";
  let out = "";
  for (const ch of text) out += shiftArabicChar(ch, -s);
  return out;
}

/** ===== 3) VigenÃ¨re Arabic (by shifts) ===== */
function vigenereEncrypt(text, keyWord){
  keyWord = (keyWord || "").trim();
  if (!keyWord) return "âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„: ÙƒÙ†Ø²)";
  const shifts = [];
  for (const ch of keyWord){
    if (isArabicLetter(ch)) shifts.push(alphaIndex(ch));
  }
  if (!shifts.length) return "âš ï¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ©";
  let ki = 0;
  let out = "";
  for (const ch of text){
    if (isArabicLetter(ch)){
      const sh = shifts[ki % shifts.length];
      out += shiftArabicChar(ch, sh);
      ki++;
    } else out += ch;
  }
  return out;
}
function vigenereDecrypt(text, keyWord){
  keyWord = (keyWord || "").trim();
  if (!keyWord) return "âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ (Ù…Ø«Ù„: ÙƒÙ†Ø²)";
  const shifts = [];
  for (const ch of keyWord){
    if (isArabicLetter(ch)) shifts.push(alphaIndex(ch));
  }
  if (!shifts.length) return "âš ï¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ©";
  let ki = 0;
  let out = "";
  for (const ch of text){
    if (isArabicLetter(ch)){
      const sh = shifts[ki % shifts.length];
      out += shiftArabicChar(ch, -sh);
      ki++;
    } else out += ch;
  }
  return out;
}

/** ===== 4) Atbash Arabic ===== */
function atbash(text){
  const n = ALPH.length;
  let out = "";
  for (const ch of text){
    const c = normalizeArabicChar(ch);
    const i = ALPH.indexOf(c);
    if (i === -1) out += ch;
    else out += ALPH[(n - 1) - i];
  }
  return out;
}

/** ===== 5) Base64 (UTF-8 safe) ===== */
function toBase64Unicode(str){
  const utf8 = encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_,p)=>String.fromCharCode(parseInt(p,16)));
  return btoa(utf8);
}
function fromBase64Unicode(b64){
  const bytes = atob(b64);
  const esc = Array.from(bytes, c => "%" + c.charCodeAt(0).toString(16).padStart(2,"0")).join("");
  return decodeURIComponent(esc);
}

/** ===== HELP CONTENT ===== */
function buildArabicNumberTable(){
  let html = "<table><thead><tr><th>Ø§Ù„Ø­Ø±Ù</th><th>Ø§Ù„Ø±Ù‚Ù…</th></tr></thead><tbody>";
  for (let i=0; i<ALPH.length; i++){
    html += `<tr><td>${ALPH[i]}</td><td>${i+1}</td></tr>`;
  }
  html += "</tbody></table>";
  return html;
}

function buildAtbashTable(){
  const n = ALPH.length;
  let html = "<table><thead><tr><th>Ø§Ù„Ø£ØµÙ„</th><th>Ø§Ù„Ù…Ø´ÙÙ‘Ø±</th></tr></thead><tbody>";
  for (let i=0; i<n; i++){
    html += `<tr><td>${ALPH[i]}</td><td>${ALPH[(n-1)-i]}</td></tr>`;
  }
  html += "</tbody></table>";
  return html;
}

function buildCaesarMiniTable(shift){
  const s = Number.isFinite(shift) ? shift : 2;
  const sample = ["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø¯","Ø±","Ø³","Øµ","Ø¹","Ù","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ"];
  let html = "<table><thead><tr><th>Ø§Ù„Ø£ØµÙ„</th><th>Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø²Ø§Ø­Ø©</th></tr></thead><tbody>";
  for (const ch of sample){
    html += `<tr><td>${ch}</td><td>${shiftArabicChar(ch, s)}</td></tr>`;
  }
  html += "</tbody></table>";
  return html;
}

function buildVigenereKeyTable(keyWord){
  const shifts = [];
  for (const ch of (keyWord || "")){
    if (isArabicLetter(ch)) shifts.push({ch: normalizeArabicChar(ch), sh: alphaIndex(ch)});
  }
  if (!shifts.length) return "<div class='small'>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ Ø¹Ø±Ø¨ÙŠØ© Ù„ÙŠØ¸Ù‡Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø²Ø§Ø­Ø§Øª.</div>";
  let html = "<table><thead><tr><th>Ø­Ø±Ù Ø§Ù„Ù…ÙØªØ§Ø­</th><th>Ø§Ù„Ø¥Ø²Ø§Ø­Ø©</th></tr></thead><tbody>";
  for (const it of shifts){
    html += `<tr><td>${it.ch}</td><td>${it.sh}</td></tr>`;
  }
  html += "</tbody></table>";
  return html;
}

function helpFor(mode, key){
  const baseExampleText = "ØªØ¬Ø¯ Ø§Ù„ÙƒÙ†Ø² ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¨ÙŠØª";
  if (mode === "arabic_numbers"){
    return {
      title: "ğŸ”¢ ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
      text: `
        <p>ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ ÙƒÙ„ <b>Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠ</b> Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø­Ø³Ø¨ ØªØ±ØªÙŠØ¨Ù‡ ÙÙŠ Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠØ©.</p>
        <p>Ù…Ø«Ø§Ù„: <code>Ø§ = 1</code>ØŒ <code>Ø¨ = 2</code>ØŒ <code>Øª = 3</code> â€¦</p>
        <p>Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù…Ø² <code>|</code> Ù„Ù„ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª (Ø¨Ø¯Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.</p>
      `,
      example: `Ø§Ù„Ù†Øµ: ${baseExampleText}\nØ§Ù„Ù†Ø§ØªØ¬: ${arabicToNumbers(baseExampleText)}\n\nÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±: Ø¶Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø«Ù… Ø§Ø¶ØºØ· "ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±"`,
      tableTitle: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø±ÙˆÙ â†’ Ø£Ø±Ù‚Ø§Ù…",
      tableHTML: buildArabicNumberTable(),
      showTable: true
    };
  }

  if (mode === "caesar_ar"){
    const s = parseInt(key,10);
    const used = Number.isNaN(s) ? 2 : s;
    return {
      title: "ğŸ” ØªØ´ÙÙŠØ± Ù‚ÙŠØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ø¥Ø²Ø§Ø­Ø©)",
      text: `
        <p>Ù†Ø­Ø±Ù‘Ùƒ ÙƒÙ„ Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø£Ù…Ø§Ù… Ø¨Ø¹Ø¯Ø¯ Ø«Ø§Ø¨Øª (Ø§Ù„Ù…ÙØªØ§Ø­).</p>
        <p>Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙØªØ§Ø­ <code>${used}</code> ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ: ÙƒÙ„ Ø­Ø±Ù ÙŠØªØ­ÙˆÙ„ Ù„Ù„Ø­Ø±Ù Ø§Ù„Ø°ÙŠ Ø¨Ø¹Ø¯Ù‡ Ø¨Ù€ <b>${used}</b> Ø®Ø·ÙˆØ§Øª.</p>
        <p><b>Ù„ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</b> Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„ÙƒÙ† Ø¨Ø§Ù„Ø¹ÙƒØ³.</p>
      `,
      example: `Ø§Ù„Ù†Øµ: ÙƒÙ†Ø²\nØ§Ù„Ù…ÙØªØ§Ø­: ${used}\nØ§Ù„Ù†Ø§ØªØ¬: ${caesarEncrypt("ÙƒÙ†Ø²", String(used))}\n\nÙ…Ø«Ø§Ù„ Ø£Ø·ÙˆÙ„:\n${baseExampleText}  â†’  ${caesarEncrypt(baseExampleText, String(used))}`,
      tableTitle: "Ø£Ù…Ø«Ù„Ø© ØªØ­ÙˆÙŠÙ„ (Ù…Ø®ØªØµØ±)",
      tableHTML: buildCaesarMiniTable(used),
      showTable: true
    };
  }

  if (mode === "vigenere_ar"){
    const kw = (key || "").trim() || "ÙƒÙ†Ø²";
    return {
      title: "ğŸ”‘ VigenÃ¨re Ø¹Ø±Ø¨ÙŠ (Ø¨ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­)",
      text: `
        <p>ØªÙƒØªØ¨ <b>ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­</b> (Ù…Ø«Ù„Ø§Ù‹: <code>${kw}</code>).</p>
        <p>ÙƒÙ„ Ø­Ø±Ù ÙÙŠ Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ¹Ø·ÙŠ Ø¥Ø²Ø§Ø­Ø© Ù…Ø®ØªÙ„ÙØ©ØŒ Ø«Ù… ØªÙØ·Ø¨Ù‘ÙÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø²Ø§Ø­Ø§Øª Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø­Ø±ÙˆÙ Ø§Ù„Ù†Øµ.</p>
        <p>Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù…ØªØ¹ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø² Ù„Ø£Ù†Ù‡ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ <b>ÙƒÙ„Ù…Ø© Ø³Ø±</b> Ø¨Ø¯Ù„ Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯.</p>
      `,
      example: `Ø§Ù„Ù†Øµ: ÙƒÙ†Ø²\nØ§Ù„Ù…ÙØªØ§Ø­: ${kw}\nØ§Ù„Ù†Ø§ØªØ¬: ${vigenereEncrypt("ÙƒÙ†Ø²", kw)}\n\nÙ…Ø«Ø§Ù„ Ø£Ø·ÙˆÙ„:\n${baseExampleText}  â†’  ${vigenereEncrypt(baseExampleText, kw)}`,
      tableTitle: "Ø­Ø±ÙˆÙ Ø§Ù„Ù…ÙØªØ§Ø­ â†’ Ø§Ù„Ø¥Ø²Ø§Ø­Ø§Øª",
      tableHTML: buildVigenereKeyTable(key),
      showTable: true
    };
  }

  if (mode === "atbash_ar"){
    return {
      title: "ğŸ”„ Atbash Ø¹Ø±Ø¨ÙŠ (Ø¹ÙƒØ³ Ø§Ù„Ø­Ø±ÙˆÙ)",
      text: `
        <p>Ù†Ù‚ÙˆÙ… Ø¨Ø¹ÙƒØ³ Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠØ©: Ø£ÙˆÙ„ Ø­Ø±Ù ÙŠØµØ¨Ø­ Ø¢Ø®Ø± Ø­Ø±ÙØŒ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ ÙŠØµØ¨Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø®ÙŠØ±â€¦</p>
        <p>Ù…Ø«Ø§Ù„: <code>Ø§ â†” ÙŠ</code>ØŒ <code>Ø¨ â†” Ùˆ</code>ØŒ <code>Øª â†” Ù‡</code> â€¦</p>
        <p>Ù…ÙŠØ²Ø© Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹: <b>Ø§Ù„ØªØ´ÙÙŠØ± ÙˆÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± Ù†ÙØ³ Ø§Ù„Ø²Ø±</b> (Ù†ÙØ³ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©).</p>
      `,
      example: `Ø§Ù„Ù†Øµ: ÙƒÙ†Ø²\nØ§Ù„Ù†Ø§ØªØ¬: ${atbash("ÙƒÙ†Ø²")}\n\nÙ…Ø«Ø§Ù„ Ø£Ø·ÙˆÙ„:\n${baseExampleText}  â†’  ${atbash(baseExampleText)}`,
      tableTitle: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹ÙƒØ³ (ÙƒØ§Ù…Ù„)",
      tableHTML: buildAtbashTable(),
      showTable: true
    };
  }

  // base64
  return {
    title: "ğŸ“¦ Base64 Ù„Ù„Ù†Øµ",
    text: `
      <p>Ù‡Ø°Ø§ Ù„ÙŠØ³ ØªØ´ÙÙŠØ± Ø£Ù„ØºØ§Ø²ØŒ Ø¨Ù„ <b>ØªØ±Ù…ÙŠØ²</b> ÙŠØ¬Ø¹Ù„ Ø§Ù„Ù†Øµ Ù…Ù†Ø§Ø³Ø¨Ù‹Ø§ Ù„Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„.</p>
      <p>Ù…ÙÙŠØ¯ Ù„Ùˆ ØªØ¨ØºÙ‰ ØªØ±Ø³Ù„ Ø§Ù„Ù†Øµ Ø¨Ø´ÙƒÙ„ â€œØ´ÙƒÙ„ Ù…Ø®ØªÙ„Ùâ€ Ø¨Ø³Ø±Ø¹Ø©ØŒ Ù„ÙƒÙ†Ù‡ <b>Ø³Ù‡Ù„ ÙÙƒÙ‘Ù‡</b>.</p>
    `,
    example: `Ø§Ù„Ù†Øµ: ${baseExampleText}\nØ§Ù„Ù†Ø§ØªØ¬: ${toBase64Unicode(baseExampleText)}\n\nÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±: Ø§Ù„ØµÙ‚ Base64 ÙˆØ§Ø¶ØºØ· "ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±"`,
    tableTitle: "",
    tableHTML: "",
    showTable: false
  };
}

/** ===== UI wiring ===== */
const elPlain = document.getElementById("plain");
const elOut   = document.getElementById("out");
const elMode  = document.getElementById("mode");
const elKey   = document.getElementById("key");
const elHint  = document.getElementById("modeHint");

const helpPanel = document.getElementById("helpPanel");
const toggleHelpBtn = document.getElementById("toggleHelpBtn");
const helpTitle = document.getElementById("helpTitle");
const helpText = document.getElementById("helpText");
const helpExample = document.getElementById("helpExample");
const helpTable = document.getElementById("helpTable");
const tableBlock = document.getElementById("tableBlock");
const tableTitle = document.getElementById("tableTitle");

function updateHint(){
  const m = elMode.value;
  const hints = {
    arabic_numbers: "ÙŠØ­Ù‘ÙˆÙ„ ÙƒÙ„ Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠ Ù„Ø±Ù‚Ù…. Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ |",
    caesar_ar: "Ø¥Ø²Ø§Ø­Ø© Ø¨Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ø§Ù„Ù…ÙØªØ§Ø­ Ø±Ù‚Ù… Ù…Ø«Ù„ 3",
    vigenere_ar: "Ù…ÙØªØ§Ø­ ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ© (Ù…Ø«Ù„ ÙƒÙ†Ø²). ÙƒÙ„ Ø­Ø±Ù ÙÙŠ Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ¹Ø·ÙŠ Ø¥Ø²Ø§Ø­Ø©",
    atbash_ar: "ÙŠØ¹ÙƒØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø±ÙˆÙ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)",
    base64: "Ù…ÙÙŠØ¯ Ù„Ù„Ù†Ø³Ø®/Ø§Ù„Ù„ØµÙ‚. Ù„ÙŠØ³ Ù„ØºØ²Ù‹Ø§ Ù‚ÙˆÙŠÙ‹Ø§ Ù„ÙƒÙ†Ù‡ Ø¹Ù…Ù„ÙŠ",
  };
  elHint.textContent = hints[m] || "";
}

function updateHelp(){
  const m = elMode.value;
  const key = elKey.value;
  const h = helpFor(m, key);

  helpTitle.textContent = h.title;
  helpText.innerHTML = h.text;
  helpExample.textContent = h.example;

  if (h.showTable){
    tableBlock.style.display = "block";
    tableTitle.textContent = h.tableTitle || "Ø¬Ø¯ÙˆÙ„";
    helpTable.innerHTML = h.tableHTML;
  } else {
    tableBlock.style.display = "none";
    helpTable.innerHTML = "";
  }
}

updateHint();
updateHelp();

elMode.addEventListener("change", ()=>{
  updateHint();
  updateHelp();
});

elKey.addEventListener("input", ()=>{
  // Ø¹Ø´Ø§Ù† Ø¬Ø¯ÙˆÙ„ VigenÃ¨re/Ù‚ÙŠØµØ± ÙŠØªØ­Ø¯Ø« Ù…Ø¨Ø§Ø´Ø±Ø©
  updateHelp();
});

toggleHelpBtn.addEventListener("click", ()=>{
  const open = helpPanel.classList.toggle("open");
  toggleHelpBtn.textContent = open ? "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±Ø­" : "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±Ø­";
});

function encrypt(){
  const text = elPlain.value;
  const key  = elKey.value;
  const m    = elMode.value;

  if (m === "arabic_numbers") elOut.value = arabicToNumbers(text);
  else if (m === "caesar_ar") elOut.value = caesarEncrypt(text, key);
  else if (m === "vigenere_ar") elOut.value = vigenereEncrypt(text, key);
  else if (m === "atbash_ar") elOut.value = atbash(text);
  else if (m === "base64") elOut.value = toBase64Unicode(text);
}

function decrypt(){
  const text = elPlain.value;
  const key  = elKey.value;
  const m    = elMode.value;

  try{
    if (m === "arabic_numbers") elOut.value = numbersToArabic(text);
    else if (m === "caesar_ar") elOut.value = caesarDecrypt(text, key);
    else if (m === "vigenere_ar") elOut.value = vigenereDecrypt(text, key);
    else if (m === "atbash_ar") elOut.value = atbash(text);
    else if (m === "base64") elOut.value = fromBase64Unicode(text);
  } catch(e){
    elOut.value = "âš ï¸ Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£ÙÙƒ Ø§Ù„Ù†Øµ. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª.";
  }
}

document.getElementById("encryptBtn").addEventListener("click", encrypt);
document.getElementById("decryptBtn").addEventListener("click", decrypt);

document.getElementById("copyBtn").addEventListener("click", async ()=>{
  try{
    await navigator.clipboard.writeText(elOut.value);
    alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Ø§ØªØ¬ âœ…");
  }catch{
    elOut.select();
    document.execCommand("copy");
    alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Ø§ØªØ¬ âœ…");
  }
});

document.getElementById("swapBtn").addEventListener("click", ()=>{
  elPlain.value = elOut.value;
  elOut.value = "";
});

document.getElementById("clearBtn").addEventListener("click", ()=>{
  elPlain.value = "";
  elOut.value = "";
  elKey.value = "";
});
</script>
</body>
</html>
